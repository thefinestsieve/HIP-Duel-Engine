namespace = hde_feast

# If I end up doing it, this will be a file for holding modified versions of vanilla events
# These versions will replace events in vanilla event chains like feasts, regency duels, prison escapes, etc
# This way, the number of changes to vanilla files will be minimal

#####################
### SETUP
### 0-99 reserved
# This event is called from the event 72030 and hijacks the event chain
# I believe the craven stuff in this is possibly too harsh?
#Duel: Accept or Decline
character_event = {
	id = hde_feast.0
	desc = "EVTDESC72031"
	picture = GFX_evt_melee
	is_triggered_only = yes

	option = {
		name = EVTOPTA72031 #Accept
		ai_chance = {
			factor = 100
			modifier = {
				factor = 2
				trait = poor_warrior
			}
			modifier = {
				factor = 3
				trait = trained_warrior
			}
			modifier = {
				factor = 4
				trait = skilled_warrior
			}
			modifier = {
				factor = 5
				trait = master_warrior
			}
			modifier = {
				factor = 5
				trait = duelist
			}
			modifier = {
				factor = 2
				trait = brave
			}
			modifier = {
				factor = 2
				trait = proud
			}
			modifier = {
				factor = 1.5
				trait = wroth
			}
			modifier = {
				factor = 1.5
				trait = strong
			}
		}

		# Set Duel Type
		set_character_flag = flag_duel_feast
		FROM = { set_character_flag = flag_duel_feast }
		# Start this thing!
		FROM = { character_event = { id = hde_core.0 } }
	}
	option = {
		name = EVTOPTB72031 #Decline
		ai_chance = {
			factor = 100
			modifier = {
				factor = 2
				FROM = { trait = poor_warrior }
			}
			modifier = {
				factor = 3
				FROM = { trait = trained_warrior }
			}
			modifier = {
				factor = 4
				FROM = { trait = skilled_warrior }
			}
			modifier = {
				factor = 5
				FROM = { trait = master_warrior }
			}
			modifier = {
				factor = 5
				FROM = { trait = duelist }
			}
			modifier = {
				factor = 2
				FROM = { trait = strong }
			}
			modifier = {
				factor = 2
				trait = craven
			}
			modifier = {
				factor = 2
				trait = paranoid
			}
			modifier = {
				factor = 2
				trait = weak
			}
			modifier = {
				factor = 2
				trait = dwarf
			}
			modifier = {
				factor = 2
				trait = hunchback
			}
			modifier = {
				factor = 2
				trait = leper
			}
			modifier = {
				factor = 2
				trait = wounded
			}
			modifier = {
				factor = 4
				trait = maimed
			}
		}
		
		prestige = -10
		if = {
			limit = { NOT = { trait = craven } }
			random = {
				chance = 25
				add_trait = craven
			}
		}
	}
}

#####################
### INITIAL FLAVOR
### 100-199 reserved
### Since choosing whether to run or not is done in the introduction events, these are pure flavor
# Aggressor taunts Defender (ROOT = Winner, FROMFROM = Loser)
# Pull some flavor from Monkey Island for these?
character_event = {
	id = hde_feast.100
	desc = hde_feast.100.desc
	picture = GFX_evt_melee
	border = GFX_event_normal_frame_war
	hide_from = yes
	show_from_from = yes
	is_triggered_only = yes
	
	option = {
		name = hde_feast.100.
		
		FROMFROM = { # Send event to Loser
			character_event = { id = hde_feast.102 tooltip = hde_feast.102.tt }
		}
	}
}
# Aggressor taunts Defender (ROOT = Loser, FROM = Winner)
character_event = {
	id = hde_feast.101
	desc = hde_feast.101.desc
	picture = GFX_evt_melee
	border = GFX_event_normal_frame_war
	is_triggered_only = yes
	
	option = {
		name = hde_feast.101.a
		
		FROM = { # Send event to Winner
			character_event = { id = hde_feast.102 tooltip = hde_feast.102.tt }
		}
	}
}
# Defender responds (Sent to Winner or Loser)
character_event = {
	id = hde_feast.102
	desc = hde_feast.102.desc
	picture = GFX_evt_melee
	border = GFX_event_normal_frame_war
	is_triggered_only = yes
	
	option = {
		name = hde_feast.102.a
		
		if = {
			limit = { has_character_flag = flag_duel_loser }
			FROM = { # Send handler to Winner
				character_event = { id = hde_core.4 tooltip = hde_core.4.tt }
			}
		}
		if = {
			limit = { has_character_flag = flag_duel_winner }
			FROM = { # Send handler bounce to Loser
				character_event = { id = hde_core.5 tooltip = hde_core.5.tt }
			}
		}
	}
}

#####################
### SIZING UP FLAVOR
### 200-299 reserved

#####################
### COMBAT FLAVOR
### 300-399 reserved

#####################
### SUBDUED OUTCOME FLAVOR
### 400-499 reserved

#####################
### WOUNDED OUTCOME FLAVOR
### 500-599 reserved

#####################
### KILLED OUTCOME FLAVOR
### 600-699 reserved

#####################
### OUTPUT FLAVOR
### 700-799 reserved
## Chain 1
# Winner duel outcomes (Winner = ROOT, Loser = FROMFROM)
# Send something to the loser?
character_event = {
	id = hde_feast.700
	desc = hde_feast.700.desc
	picture = GFX_evt_melee
	is_triggered_only = yes

	option = {
		name = "EVTOPTA72033"
		trigger = {
			has_character_flag = flag_duel_wounded_opponent
		}
		any_liege = {
			limit = {
				has_character_flag = host_feast_started
				has_character_modifier = holding_large_feast
			}
			character_event = {
				id = 72036
				tooltip = "EVTTOOLTIP72036"
			}
		}
		change_martial = 1
	}

	option = {
		name = "EVTOPTB72033"
		trigger = {
			has_character_flag = flag_duel_maimed_opponent
		}
		any_liege = {
			limit = {
				has_character_flag = host_feast_started
				has_character_modifier = holding_large_feast
			}
			character_event = {
				id = 72037
				tooltip = "EVTTOOLTIP72037"
			}
		}
		change_martial = 2
	}

	option = {
		name = "EVTOPTC72033"
		trigger = {
			has_character_flag = flag_duel_killed_opponent
		}
		any_liege = {
			limit = {
				has_character_flag = host_feast_started
				has_character_modifier = holding_large_feast
			}
			character_event = {
				id = 72035
				tooltip = "EVTTOOLTIP72035"
			}
		}
		change_martial = 3
	}
	option = {
		name = hde_feast.700.d
		trigger = {
			has_character_flag = flag_duel_spared_opponent
		}
		clr_character_flag = flag_duel_spared_opponent
		any_liege = {
			limit = {
				has_character_flag = host_feast_started
				has_character_modifier = holding_large_feast
			}
			character_event = {
				id = hde_feast.701
				tooltip = hde_feast.701.tt
			}
		}
		change_martial = 1
	}
}
# Liege reacts to nobody being hurt
character_event = {
	id = hde_feast.701
	desc = hde_feast.701.desc
	picture = GFX_evt_melee
	is_triggered_only = yes

	option = {
		name = "EVTOPTA72035"
		opinion = {
			modifier = opinion_dislike
			who = FROM
			years = 10
		}
	}
	option = {
		name = "EVTOPTB72035"
		opinion = {
			modifier = opinion_satisfied
			who = FROM
			years = 10
		}
	}
	option = {
		name = "EVTOPTC72035"
		reverse_opinion = {
			modifier = opinion_dislike
			who = FROM
			years = 10
		}
	}
}
